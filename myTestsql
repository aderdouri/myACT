SELECT
    cust.id COMPANY,
    ES.SENT, NVL(EA.ACPT, 0) ACPT,
    NVL(EN.RJCT, 0) RJCT,
    NVL((ES.SENT - nvl(EA.ACPT,0) - nvl(EN.RJCT,0)), 0) NOREPLY
    FROM
    (SELECT RPTGCTRPTY, count(*) AS SENT FROM cdmEmirMarginActivity_HIST
    WHERE
    TO_CHAR(RPTGTMSTMP, 'DD-MM-YYYY') > '03-05-2024'
    AND STATUS ='SENT' GROUP BY RPTGCTRPTY) ES
    LEFT JOIN
    (SELECT RPTGCTRPTY, count(*) AS ACPT
    FROM cdmEmirMarginActivity_HIST
    WHERE TO_CHAR(RPTGTMSTMP, 'DD-MM-YYYY') > '03-05-2024'
    and STATUS ='ACPT'
    GROUP BY RPTGCTRPTY) EA ON ES.RPTGCTRPTY = EA.RPTGCTRPTY
    LEFT JOIN
    (SELECT RPTGCTRPTY, count(*) AS RJCT
    FROM cdmEmirMarginActivity_HIST
    WHERE TO_CHAR(RPTGTMSTMP, 'DD-MM-YYYY') > '03-05-2024'
    AND STATUS ='RJCT'
    GROUP BY RPTGCTRPTY) EN ON ES.RPTGCTRPTY = EN.RPTGCTRPTY
    LEFT JOIN
    (SELECT id, cdmlei FROM dmCUSTOMER
    WHERE audit_current='Y'
    AND audit_entitystate='VER')
    cust on cust.cdmlei = ES.RPTGCTRPTY
    ORDER BY cust.id;
